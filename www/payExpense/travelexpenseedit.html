<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>差旅费报销</title>
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0' />
    <meta name="renderer" content="webkit">
    <link rel="stylesheet" href="../font/iconfont.css">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/data.css">
    <link rel="stylesheet" href="../css/zui.css">
    <link href="../css/common.css" type="text/css" rel="stylesheet">
    <link href="../css/index.css" type="text/css" rel="stylesheet">

    <script src="../js/rem.js"></script>
    <script type="text/javascript" src="../js/rolldate.min.js"></script>

    <script src="../js/flyformdatapageapp.js"></script>
    <script src="../js/flyeditpageapp.js"></script>
    <script src="../js/pubToolsapp.js"></script>
    <script src="../js/pubUtilapp.js"></script>
    <script src="../js/flycommonselectapp.js"></script>
    <script src="../js/flyapp.js"></script>
    <script type="text/javascript" src="../js/ajaxPubapp.js"></script>
    <script src="../js/outPersonInput.js"></script>
    <script type="text/javascript" src="../js/rolldate.min.js"></script>
    <script src="../js/common.js"></script>

    <script type="text/javascript">

        var loginInsId_a = "";
        var loginDeptId_a = "";
        var loginPerId_a = "";
        var pageObj_a = "";//top页面对象，用以取得全局设置。

        //实现flyeditpage接口，保存成功后导向显示页面。dataKey通用程序已编码
        function toShowPage(dataKey,authFlag,flag){

            window.location.href="travelExpenseShow.html?flag=Show&dataKey="+dataKey+"&authFlag="+authFlag+"&progId="+flyEditPageGetProgId();
        }

        /**
         * 保存校验。实现flyeditpage接口。
         * 实现js接口.修改或保存提交时，当前特殊业务进行校验。
         * (必输、编码合规性、数字、长度、非法字符这里不用校验，程序已自动校验。)

         * @return true or false
         */
        function flyEditPageSubmitCheck(){

            //设置为录入人不选择指标，则不校验。
            // if(isPostSetPayIndex())
            return true;

            //指标校验。
            // return payEditPageIndexCheck(1);


        }
        /**
         * 审批校验。实现flyeditpage接口。审批时，校验提交数据是否符合审批提交要求。
         * 审批时，才需要实现该接口，没有审批，不需要。
         * @param fromId  输入区域form。
         * @return 合规返回true；不合规返回false
         */
        function appPageCheck(fromId){

            return true;
        }

        /**
         * 后台服务器操作接口。
         * 1、确定servlet地址即可
         * 2、后台取值两个，flag、opValue。
         * 3、根据flag判断，拆串opValue，进行处理
         * @param flag     操作标识
         * @param opValue  处理的值，一般为拼串。到后台要拆串
         * @return 处理结果值。正确返回相应值或标识，错误返回错误标识，由前台提示
         */
        function toServerOp(flag,opValue){

            if(opValue && opValue.indexOf("|々|")>0)
                opValue = opValue.replace(/\|々\|/g,"々")

            var info = "opValue="+opValue;

            var result = getHttpResponse("/fwis/mssl/payTraveExpenseSrv",flag,info);

            if((flag=="AddSave" || flag=="UpdSave" || flag=="AddSaveApprove" || flag=="UpdSaveApprove")){

                var arr = result.split("|");

                if(arr[0]=="RepeatSubsidy"){

                    alert("抱歉，"+arr[1]+"重复报销,请重新调整");
                    result = arr[0];

                }else if(arr[0]=="RepeatReceipt"){

                    alert("抱歉，"+arr[1]+"发票重复,请重新调整");
                    result = arr[0];
                }else if(arr[0]=="RepeatReceiptInput"){

                    alert("抱歉，您录入了重复的发票,请重新调整");
                    result = arr[0];
                }
            }

            return result;
        }


        /**
         * 选择
         * 弹出选择页面,参数说明
         * commonSelectPageInit(progId,preReq,query,pageWidth,pageHeigth,fromLeft,fromTop,backValue,model)
         * @ progId      选择程序代码，不可为空
         * @ preReq      选择程序前置条件，可为空。根据定义，对应条件值，如不传递则nbsp，返回则传递相应值，如nbsp|001|T03。则传递第二、第三个值，第一个不传递。
         * @ query       选择程序查询条件，可为空
         * @ pageWidth   弹出页面宽度，不可为空。为整数，百分比，如80则，是整个页面宽度的80%
         * @ pageHeigth  弹出页面高度，不可为空。为整数，百分比，如60则，是整个页面高度的80%
         * @ fromLeft    弹出页面距离左边的距离，不可为空。为整数，百分比，如10则，是距离页面左边距的10%
         * @ fromTop     弹出页面距离顶边的距离，不可为空。为整数，百分比，如20则，是距离页面顶边距的20%
         * @ backValue   返回值拼串。根据定义，对应返回值，0不返回，1返回。如"1|0|1"，则返回第一个和第三个值。
         * @ backFun     返回值调用的函数。
         * @ model       选择模式。multiple多选，""单选。
         * @ sql         特殊情况时加入自己需要的sql
         * @ obj         选择对象
         * @ orderBy     排序语句
         * @ return      单选，返回一个数组[];多选返回组合数组，[[],[],[]]，组合数组中每个数组是选中的一个值。

         回调函数setSelAssetType(assetArr)
         */
        function getSel(obj,typeFlag){

            var selProgId = "";
            var preCon = "";
            var query = "";
            var selType = "S";//默认单选
            var selFlag = "";
            var backFun = "";

            var conSql = "";
            var orderBy = "";
            var showModel = "A";//默认一行显示
            var showValue = "";

            //同行人为多选，项目、指标为单选
            if(typeFlag=="I"){//项目

                showValue = "7|6|0|0|0";
                preCon = loginInsId_a+"|nbsp|nbsp|nbsp|nbsp|nbsp";
                selProgId = "projectSelPage";
                backFun = "commonSelectSetSelInput";
                selFlag = "0|1|1|0|0";

            }else if(typeFlag=="D"){//指标

                selProgId = "indexDetailSelect";
                preCon = loginInsId_a;
                backFun = "indexSet";
                selFlag = "1|1|1|1|1";
                showValue = "2|3|0|0|0";
                conSql = " i_leaf='Y'";
                orderBy = "i_year desc,case when decom_user_id in ('"+loginDeptId_a+"','"+loginPerId_a+"')  then 1 ELSE 6 END";

            }else if(typeFlag=="P"){//人员

                selProgId = "personSelectPage";
                preCon = loginInsId_a+"|nbsp";
                backFun = "commonSelectSetSelArrLabel";
                selType = "multiple";
                selFlag = "1|0|1|1|0|1";
                showValue = "0|0|5|0|0|2";
                orderBy = "(case when sys_dept_id ='"+loginDeptId_a+"' then 1 ELSE 6 END)";

            }else if(typeFlag=="O"){//编外人员

                openOutPersonInputSel(obj,loginInsId_a,"");
                return;

            }else if(typeFlag=="T"){//第三方支付单位

                thirdPayInsInputSel(obj,loginInsId_a);
                return;

            }else if(typeFlag=="B"){//借款单

                var appPer  = document.getElementById("personSelId").value;
                if(appPer.trim().length<1){

                    alert("请选择报销人");
                    return;
                }

                selProgId = "borrowBillPage";
                preCon = appPer+"|Y|Y";
                backFun = "borrowSet";
                selType = "";
                selFlag = "1|1|1|1";
                showValue = "1|2|0|0";

            }else if(typeFlag=="A"){//申请单

                // var appPer  = document.getElementById("personSelId").value;
                var appPer  = document.getElementById("personSelIdName").getAttribute("flyvalue");
                if(appPer.trim().length<1){

                    alert("请选择报销人");
                    return;
                }

                selProgId = "travelApplyPage";
                preCon = appPer+"|Y|Y";
                //preCon = "nbsp|Y|Y";
                backFun = "applySet";
                selType = "";
                selFlag = "1|1|1";
                //selType = "multiple";
                conSql = " (exp_status_id<>'Y' or exp_status_id is null) ";
                showValue = "1|2|0";
            }else if(typeFlag=="R"){//出差地址

                //处理市郊区出行，与外地出差地点
                var defTypeId = document.getElementById('typeSelId').value;
                if(defTypeId == "bd1097")
                    conSql = " addr_type_id='N'";
                else
                    conSql = " (addr_type_id<>'N' or  addr_type_id is null)";

                selProgId = "travelAddrSelectPage";
                preCon = loginInsId_a+"|nbsp";
                backFun = "addrSelSet";
                selType = "";
                selFlag = "1|1|0|0|0|0";
                showValue = "1|3|0|0|0|0";
                orderBy = "sel_order desc";
            }
            commonSelectAppPageInit(selProgId,preCon,query,selFlag,backFun,selType,conSql,obj,orderBy,showModel,showValue);

        }

        /**
         * 申请单选择回调函数，设置申请单，并将申请单信息从后台查询，置入报销单。
         置入信息：1、主信息；2、指标；3、明细。
         * @param arr  选择返回指标信息数组
         * @param obj  选择表单对象
         * @return
         */
        function applySet(selArr,obj){

            //ins_id,a_code,a_name
            /*
            obj.setAttribute("flyvalue",selArr[1]);
            obj.value = selArr[2];
            */

            var appBillsId = "";
            var appId = "";
            //设置表单信息
            var flyvalue = "";
            obj.innerHTML =  "";//清空原申请单


            obj.setAttribute("flyvalue",selArr[1]);
            obj.value = selArr[2];

            appBillsId = "'"+selArr[1]+"'";

            appId = selArr[1];

            //取得并设置申请单信息
            //1、第一次选择，按如下设置；第二次选择手动设置，同行人员、同行人员数量、指标。
            var appInfo = toServerOp("AppInfo",selArr[0]+"^"+selArr[1]+"^"+appBillsId);

            var idArr = ["reasonId","itemId","togetherId","togetherNumId","addrId","billName","startDate","endDate","typeSelId","specialSelId","appBillAmtId","indexTable","travelTableId"];

            var arr = appInfo.split("々");

            var dataArr = arr[0].split("|");


            arr[1] = arr[1].replace(/\|/g,"^");//指标
            arr[2] = arr[2].replace(/\|/g,"^");//城市间交通


            dataArr.push(arr[1]);	//指标
            dataArr.push(arr[2]);	//城市间交通

            flyFormDataPageShowTagsData(idArr,dataArr,"E");

            var tem = arr[2].split("^");

            //申请单没有行程时，不计算出差明细费用
            if(tem.length<5 || tem[1].trim().length<1 || tem[2].trim().length<1 || tem[3].trim().length<2 || tem[4].trim().length<2)
                return;

            //设置出差人员支付信息到下方支付列表
            //setTogetherPerBankInfo();

            //自动计算差旅补助
            expCount(appId);

            //自动计算报销金额
            //amtAutoCount();

            return;
        }

        /**
         * 根据行程计算出差人员住宿、交通补助、伙食补助。
         * @param appId 出差申请单号
         * @return
         */
        function expCount(appId){

            if(!appId){

                var labelObj = document.getElementById("appBillSelId").getElementsByTagName("label")[0];

                var flyvalue = labelObj.getAttribute("flyvalue");

                appId = flyvalue.split("⌒")[0];
            }

            travelDataShowChange(appId);
            // //取得人员代码、结束日期-开始日期、地点代码、城市间交通费
            // var tem = new Array();
            // var tem1 = new Array();
            // var str = "";
            // var travelArr = new Array();//行程数组，用以拼接后台返回的人员、级别信息，然后显示每个人的城市间交通
            // var nNays = "";//自然天数
            // var days = "";//住宿天数
            // var amt = "";
            // var n = 0;
            // var tableObj = "";
            //
            // //取得出差人员
            // var perIds = getExpPerson();
            //
            // //取得地点代码、结束日期-开始日期
            // var pInfo = flyFormDataPageGetData("travelTableId","^","~");
            //
            // pInfo = pInfo.replaceAll("|","^");
            //
            // var arr = pInfo.split("^");
            // //没有输入行程，或只填写一行，不计算人员费用。
            // if(arr[0].trim().length<1 || arr[1].trim().length<1 || arr[2].trim().length<8 || arr[3].trim().length<8 || arr.length<20)
            //     return;
            //
            // // //取得住宿费计算方式
            // // var hotelWay = pageObj_a.payTravelSet_a.hotel;
            // var hotelWay=getGloblePayTravelHotel();
            // // //取得是否按自然天计算住宿费标识
            // // var hotelDays = pageObj_a.payTravelSet_a.days;
            // var hotelDays=getGloblePayTravelDay() ;
            //
            // for(var i=0;i<arr.length-10;i=i+10){ //最后一行为返回行程地点，不计入差旅费用,减去最后一行。
            //
            //     //行程数组，用以拼接后台返回的人员、级别信息，然后显示每个人的城市间交通
            //     travelArr.push(arr[i+1]+"^"+arr[i+2]+"^"+arr[i+3]+"^"+arr[i+4]+"^"+arr[i+5]+"^"+arr[i+6]+"^"+arr[i+7]+"^"+arr[i+8]);
            //
            //     //计算交通费
            //     arr[i+6] = (arr[i+6].trim().length<1) ? "0" : arr[i+6];
            //
            //     amt = arr[i+6];
            //
            //     //住宿天数
            //     //days = pubUtilGetDateInterDays(arr[i+2],arr[i+11]);
            //
            //     //出差地点自然天数。离开这个地点日期减去出发到(不一定到，有的第一天出发，第二天到)这个地点日期。
            //     nDays = pubUtilGetDateInterDays(arr[i+1],arr[i+11]);
            //
            //     if(i==arr.length-20){//循环最后一行.交通费加上返回行程交通费。
            //
            //         arr[i+16] = (arr[i+16].trim().length<1) ? "0" : arr[i+16];
            //         amt = ""+(parseFloat(arr[i+6])+parseFloat(arr[i+16]));
            //         nDays = pubUtilGetDateInterDays(arr[i+1],arr[i+12]);//返回当天计一天出差
            //
            //         travelArr.push(arr[i+11]+"^"+arr[i+12]+"^"+arr[i+13]+"^"+arr[i+14]+"^"+arr[i+15]+"^"+arr[i+16]+"^"+arr[i+17]+"^"+arr[i+18]);
            //     }
            //
            //     //出差地点住宿天数。离开这个地点日期减去到达这个地点日期。
            //     //如果出差住宿天数按自然天计算，则赋值自然天数。第一天不增加，因为后台第一天增加1天。
            //     days = (hotelDays=="Y") ? nDays : pubUtilGetDateInterDays(arr[i+2],arr[i+11]);
            //
            //     //自然天数，出差第一天也计算一天
            //     if(i==0)
            //         nDays++;
            //
            //     tem = arr[i+4].split("~");//地点
            //     tem1 = arr[i+5].split("~");//交通方式
            //
            //
            //     //            天数  地点代码    金额     交通方式    自然天数
            //     perIds+= "|"+days+"^"+tem[0]+"^"+amt+"^"+tem1[0]+"^"+nDays;
            //     //perIds+= "|"+arr[i+2]+"^"+arr[i+11]+"^"+days+"^"+tem[0]+"^"+amt;
            //
            //
            // }
            //
            // perIds = hotelWay+"^"+appId+"^"+hotelDays+"|"+perIds;
            //
            //
            // var perAmt = toServerOp("ExpCount",perIds);
            //
            // //取得出发日期、返回日期，显示到主信息
            // document.getElementById('startDate').value = arr[1];
            // document.getElementById('endDate').value = arr[arr.length-8];
            //
            //
            // arr = perAmt.split("|");
            //
            // //显示前设置序号flyflag为3自动生成；显示完成，设置flyflag为0
            // //document.getElementById('subsidyNo').setAttribute("flyflag","3");
            // //document.getElementById('stayNo').setAttribute("flyflag","3");
            //
            // //显示城市间交通费
            //
            // tem = arr[1].split("^");
            //
            // for (var i=0;i<tem.length;i=i+14){//增加字段改变
            //
            //     for (var j=0;j<travelArr.length;j++)
            //         str+= "^"+tem[i]+"^"+tem[i+1]+"^"+tem[i+2]+"^"+travelArr[j];
            // }
            // flyFormDataPageShowAppData(document.getElementById("cityId"),str.substring(1),'S','^','~');
            // flyFormDataPageShowAppData(document.getElementById("stayId"),arr[0],'S','^','~');
            //
            // var subsidyIdFlyArr = arr[1].split("^");
            //
            // //设置人员其他费用
            // tem = arr[2].split("^");
            //
            // // var tableObj = document.getElementById("sumTableId");
            // var amtObj = 0;
            // var oAmt = 0;
            // var pAmt = 0;
            //
            // for (var i=0;i<tem.length;i=i+2 ){
            //
            //     for (var j=0;j<subsidyIdFlyArr.length ;j += 14 ){
            //
            //         //合计行人员代码
            //         var perSplit = subsidyIdFlyArr[j+1].split("~");
            //
            //        per = perSplit[0]+"~"+perSplit[1]+"~"+perSplit[2];
            //
            //        if(tem[i]==per){
            //             subsidyIdFlyArr[j+9] = tem[i+1];
            //
            //             amtObj = subsidyIdFlyArr[j+13];
            //
            //             oAmt = (subsidyIdFlyArr[j+13].trim().length<1) ? 0 : parseFloat(subsidyIdFlyArr[j+13]);
            //             pAmt = (tem[i+1].trim().length<1) ? 0 : parseFloat(tem[i+1]);
            //
            //             subsidyIdFlyArr[j+13] = Math.round((oAmt + pAmt)*100)/100;
            //         }
            //     }
            // }
            //
            // for (var j=0;j<subsidyIdFlyArr.length ;j += 14 ){
            //     if(subsidyIdFlyArr[j+9].trim().length ==0){
            //         subsidyIdFlyArr[j+9] = 0;
            //         subsidyIdFlyArr[j+13] = 0;
            //     }
            // }
            // arr[1] = '';
            // for(var i=0;i<subsidyIdFlyArr.length;i++){
            //     arr[1] += "^" + subsidyIdFlyArr[i];
            // }
            //
            // flyFormDataPageShowAppData(document.getElementById("subsidyId"),arr[1].substring(1),'S','^','~');

            //设置支付信息。
            setPayInfo();

            //
            // //添加总计行到合计表。
            // setSumTableRow(arr[1]);
            //
            // //设置总计行显示。
            // setSumTableRowTitle();
            //
            //
            // //点击计算时，指标金额清零，以免再次计算，指标金额翻倍。
            // flyEditPageSetIndexZero();
            //
            // amtAutoCount();//计算报销金额,显示到总计、公务卡、个人账户、第三方转账表单。
            //
            //
            //显示完成，设置flyflag为0
            /*
            arr = ["stayTableId","subsidyTableId"];
            for (var j=0;j<arr.length;j++ ){

               tableObj = document.getElementById(arr[j]);
               for (var i=1;i<tableObj.rows.length;i++ )
                  tableObj.rows[i].cells[0].getElementsByTagName("input")[0].setAttribute("flyflag","0");
            }
            */

            //将计算出的标准金额，设置到表单的flyvalue，修改时，校验是否超过标准。
            //setStandard();

            return true;
        }


        /**
         * 设置人员支付银行账户信息,申请单带入时，设置出差人员账户支付信息
         * @return
         */
        function setTogetherPerBankInfo(){

            //var pers = document.getElementById('togetherId').getElementsByTagName("label");
            var pers = "";
            var tem = new Array();
            var arr = new Array();
            var contentObj = document.getElementById('subsidyId').querySelectorAll(".content");
            contentObj.forEach(ele => {
                pers = ele.getAttribute("flyvalue");
                arr = pers.split("^")[1].split("~");
                tem.push(arr[2]);
            })

            //清空支付表格，以免修改申请单，累加支付信息
            var payTable = document.getElementById("payTableId");

            var payContainer = payTable.querySelectorAll(".container");

            for(var i = payContainer.length-1; i > 0 ; i--){
                payContainer[i].remove();
            }
            payContainer[0].style.display = "none";

            var flyvalues = getPersonPayBankInfo(tem,loginInsId_a,'A');

            return flyvalues;
        }

        /**
         * 取得出差人员.
         * 根据行程计算出差人员住宿、交通补助、伙食补助

         * @return 按sql查询格式返回人员拼串
         */
        function getExpPerson(){

            var tem = new Array();
            var flyvalue = "";
            var perIds = "";

            //取得出差报销人
            //var perIds = "'"+document.getElementById("personSelId").value+"'";

            //取得出差人
            var labels = document.getElementById('togetherId').getElementsByTagName("label");

            if(labels.length<1){

                alert("请选择出差人员");
                return;
            }

            for (var i=0;i<labels.length;i++ ){

                flyvalue = labels[i].getAttribute("flyvalue");
                tem = flyvalue.split("⌒");
                perIds+= ",'"+tem[2]+"'";

            }

            return perIds.substring(1);
        }

        /**
         * 实现flycommonselect接口，在调用commonSelectSetSelArrLabel方法前，在同行人员费用区，生成同行人员费用情况。
         * @param arr  选择返回指标信息数组
         * @param obj  选择表单对象
         * @return
         */
        function commonSelectSetSelArrLabelReback(selArr,obj){

            /*
            var str = "'"+document.getElementById("personSelId").value+"'";
            for(var i=0;i<selArr.length;i++)
                str+= ",'"+selArr[i][2]+"'";

            perAmtCount(str);


            if(obj.id == "togetherId"){

               document.getElementById("togetherNumId").value = selArr.length;

               togetherPerUpdTip();//增加人员时，提示是否重新计算人员费用
            }
            */
            return true;
        }
        /**
         * 实现flycommonselect接口，在调用commonSelectSetSelArrLabel方法后，在同行人员费用区，生成同行人员费用情况。
         * @param arr  选择返回指标信息数组
         * @param obj  span对象
         * @return
         */
        function commonSelectSetSelArrLabelRebackAfter(selArr,obj){

            if(obj.id != "togetherId")
                return true;

            //document.getElementById("togetherNumId").value = obj.getElementsByTagName("label").length;

            //togetherPerUpdTip();//增加人员时，提示是否重新计算人员费用

            return true;
        }
        /**
         * 实现flycommonselect接口,删除页面已选文件或数据前，可实现该方法从后台删除实际数据。
         * @param obj   label 对象。取得键值和名称：obj.getAttribute("flyvalue");  ,返回;labelValue+"⌒"+labelName
         * @return 执行成功返回true；失败返回false
         */
        function commonSelectDelSelLabelData(obj){

            if(obj.parentNode.id == "togetherId"){

                var perNumObj = document.getElementById("togetherNumId");

                perNumObj.value = parseInt(perNumObj.value)-1;

                return true;
            }

            var arr = obj.getAttribute("flyvalue").split("⌒");

            opValue = document.getElementById("billId").value+"|"+arr[1];

            var result=toServerOp("DelAFile",opValue);
            //var result=toServerOp("DelFile",document.getElementById("billId").value+"|"+obj.getAttribute("flyvalue")+"|"+obj.innerHTML.split("<a")[0]);

            if(result=="Y"){
                return true;
            }else{
                return false;
            }

        }
        /**
         * 实现flycommonselect接口,删除页面已选文件或数据后，可实现该方法从后台删除实际数据。
         * @param obj   span 对象。
         * @return 执行成功返回true；失败返回false
         */
        function commonSelectDelSelLabelDataAfter(obj){

            if(obj.id != "togetherId")
                return true;

            togetherPerUpdTip();//删除人员后，提示是否重新计算人员费用

            return true;

        }
        /**
         * 同行人员变化，增加或删除，提示是否进行重新计算。如果确定则重新计算费用，取消则返回。

         * @return
         */
        function togetherPerUpdTip(){

            var tableObj = document.getElementById("preTravel").getElementsByTagName("table")[0];
            if(tableObj.rows.length<3)
                return;

            if (confirm("同行人员变化，是否重新计算费用？(重新计算会覆盖原来费用金额)")==true){

                repeatCount();
            }

            return;

        }
        /**
         * 地点选择回调函数，设置出发地点，并将当前到达地点设置为下一行出发地点。

         * @param arr  选择返回指标信息数组
         * @param obj  选择表单对象
         * @return
         */
        function addrSelSet(selArr,obj){

            commonSelectSetSelInput(selArr,obj);

            var flytype = obj.getAttribute("flytype");
            if(flytype && flytype == "addr"){

                var trObj = obj.parentNode.parentNode;
                var tableObj = obj.parentNode.parentNode.parentNode;

                if(trObj.rowIndex>=tableObj.rows.length-1)
                    return;

                var n = obj.parentNode.cellIndex;//当前td序号
                var nextRowInputObj = tableObj.rows[trObj.rowIndex+1].cells[n-1].getElementsByTagName("input")[0];

                //设置出发地点
                nextRowInputObj.setAttribute("flyvalue",selArr[0]);
                nextRowInputObj.value = selArr[1];
            }
        }

        /**
         * 根据行程计算出差人员住宿、交通补助、伙食补助。
         * @param perIds  人员id的sql查询拼串
         * @return
         */
        function perAmtCount(perIds){

            //取得人员代码、结束日期-开始日期、地点代码、城市间交通费
            var tem = new Array();
            var tem1 = new Array();
            var nNays = "";//自然天数
            var days = "";//住宿天数
            var amt = "";
            var n = 0;

            //取数
            // var pInfo = flyFormDataPageGetData("preTravel","^","~");

            var arr = pInfo.split("^");

            //没有输入行程，或只填写一行，不计算人员费用。
            if(arr[1].trim().length<1 || arr[2].trim().length<1 || arr[3].trim().length<8 || arr[4].trim().length<8 || arr.length<16)
                return true;

            //取得住宿费计算方式
            var hotelWay = self.parent.banner.payTravelSet_a.hotel;
            //取得是否按自然天计算住宿费标识
            var hotelDays = self.parent.banner.payTravelSet_a.days;

            for(var i=0;i<arr.length-8;i=i+8){//最后一行为返回行程地点，不计入差旅费用。

                arr[i+6] = (arr[i+6].trim().length<1) ? "0" : arr[i+6];

                amt = arr[i+6];

                //出差地点自然天数。离开这个地点日期减去出发到(不一定到，有的第一天出发，第二天到)这个地点日期。
                nDays = pubUtilGetDateInterDays(arr[i+1],arr[i+9]);

                if(i==arr.length-16){//循环最后一行.交通费加上返回行程交通费。

                    arr[i+14] = (arr[i+14].trim().length<1) ? "0" : arr[i+14];
                    amt = ""+(parseFloat(arr[i+6])+parseFloat(arr[i+14]));
                    nDays = pubUtilGetDateInterDays(arr[i+1],arr[i+10]);//返回当天计一天出差
                }

                //出差地点住宿天数。离开这个地点日期减去到达这个地点日期。
                //如果出差住宿天数按自然天计算，则赋值自然天数。第一天不增加，因为后台第一天增加1天。
                days = (hotelDays=="Y") ? nDays : pubUtilGetDateInterDays(arr[i+2],arr[i+9]);

                //自然天数，出差第一天也计算一天
                if(i==0)
                    nDays++;

                /*
                if(i==0)//出差第一天加1，解决：当天往返，有补助；多天出差，出发与返回当天都计算补助。
                  days++;
                */

                tem = arr[i+4].split("~");//地点
                tem1 = arr[i+5].split("~");//交通方式

                //住宿天数(两个地点间隔天数)、出差地点代码、城市间交通费、交通方式、出差天数(包括非当天到达天数)
                perIds+= "|"+days+"^"+tem[0]+"^"+amt+"^"+tem1[0]+"^"+nDays;

            }



            perIds = hotelWay+"^"+hotelDays+"|"+perIds;

            //perIds = hotelWay+"|"+perIds;

            var perAmt = toServerOp("PerAmt",perIds);

            //计算总金额，显示到主信息
            var arrAmt = perAmt.split("^");
            for(var i=0;i<arrAmt.length;i=i+8)
                n+= parseFloat(arrAmt[i+7]);

            document.getElementById('planAmt').value = n.toFixed(2);

            //取得出发日期、返回日期，显示到主信息
            document.getElementById('startDateId').value = arr[1];
            document.getElementById('endDateId').value = arr[arr.length-6];

            //显示费用信息
            flyFormDataPageShowData("perAmt",perAmt,"E","^","~");

            //将计算出的标准金额，设置到表单的flyvalue，修改时，校验是否超过标准。
            setStandard();

            //点击计算时，指标金额清零，以免再次计算，指标金额翻倍。
            flyEditPageSetIndexZero();

            //赋值指标使用金额
            flyEditPageSetIndexUse(n);

            return true;
        }
        /**
         * 差旅费用计算结果展示
         * @param showData  选择返回指标信息数组
         * @return
         */
        function travelCostShow(showData){

            document.getElementById("jisuan").onclick=function () {
                var containers = this.parentElement.getElementsByClassName("container");
                for (var i = containers.length-1; i >= 0 ; i--) {
                    containers[i].remove();
                }

                var element = document.getElementById("fixed2").parentElement.parentElement.parentElement.children;
                var jiaotongMoney = 0;
                for(var i=0;i<element.length-1;i++){
                    jiaotongMoney += parseFloat(element[i].firstElementChild.firstElementChild.firstElementChild.lastElementChild.textContent.substring(1));
                }
                var chuchaipeople = document.getElementById("chuchaipeople").value;
                var peoples = chuchaipeople.split(" ");
                var tian = 2;
                var dengji = "副科级"
                var money = [100,50,50];
                for(var i=0;i<peoples.length;i++){
                    if(peoples[i] == "曹雨虹"){
                        dengji = "科级"
                        money = [130,60,60];
                    }else if(peoples[i] == "张楠"){
                        dengji = "处级"
                        money = [150,70,70];
                    }else{
                        dengji = "副科级";
                        money = [100,50,50];
                    }

                    var tkvalStr = peoples[i]+"|"+dengji+"|"+jiaotongMoney+"|"+money[0]*tian+"|"+money[1]*tian+"|"+money[2]*tian+"|"+"0";
                    var newContainer = document.createElement("div");
                    newContainer.classList.add('container');
                    newContainer.innerHTML="<div class=\"item\" data-status='0'><div class=\"content\" tkvalue='"+tkvalStr+"'>" +
                        "<div class=\"apply-third-div\"><span class=\"wd-60\">曹雨虹(科级)" +
                        "</span><span class=\"cl-e0d jt-end\">￥1000</span></div><div class=\"apply-third-div\">" +
                        "<span class=\"cl-0089D0 ta-lt\">2<span class=\"cl-afa-span\">(天)</span></span>" +
                        "<span class=\"cl-0089D0\">400<span class=\"cl-afa-span\">(基本费用)</span></span>" +
                        "<span class=\"cl-0089D0 jt-end\">100<span class=\"cl-afa-span\">(其他)</span></span>" +
                        "</div></div><div class=\"button-group\"><button class=\"del-btn\">删除</button></div></div>";
                    var parent = document.getElementById("jisuan");
                    parent.parentNode.insertBefore(newContainer,parent)
                    addSlideDelete(newContainer.getElementsByClassName("item")[0]);
                    itemOnclick(newContainer.getElementsByClassName("item")[0]);
                    itemDelete(newContainer.getElementsByClassName("del-btn")[0]);
                }
            }
        }
        /**
         * 将计算出的标准金额，设置到表单的flyvalue，修改时，校验是否超过标准。
         标准：1、住宿；2、伙食补助；3、交通补助

         * @return
         */
        function setStandard(){

            var inputObj = "";

            //1、设置住宿标准
            var tableObj = document.getElementById("perAmtTableId");

            for (var i=1;i<tableObj.rows.length;i++ ){

                inputObj = tableObj.rows[i].cells[4].getElementsByTagName("input")[0];
                inputObj.setAttribute("flyvalue",inputObj.value);

                inputObj = tableObj.rows[i].cells[5].getElementsByTagName("input")[0];
                inputObj.setAttribute("flyvalue",inputObj.value);

                inputObj = tableObj.rows[i].cells[6].getElementsByTagName("input")[0];
                inputObj.setAttribute("flyvalue",inputObj.value);
            }
            return;
        }
        /**
         * 根据行程计算出差人员住宿、交通补助、伙食补助
         * @param arr  选择返回指标信息数组
         * @param obj  选择表单对象
         * @return
         */
        function repeatCount(){

            var tem = new Array();
            var flyvalue = "";
            var perIds = "";

            //var perIds = "'"+document.getElementById("personSelId").value+"'";

            var labels = document.getElementById('togetherId').getElementsByTagName("label");

            if(labels.length<1){

                alert("请选择出差人员");
                return;
            }

            for (var i=0;i<labels.length;i++ ){

                flyvalue = labels[i].getAttribute("flyvalue");
                tem = flyvalue.split("⌒");
                perIds+= ",'"+tem[2]+"'";

            }

            perAmtCount(perIds.substring(1));

            return;
        }


        /**
         * 在预计费用中，修改住宿、伙食补助、交通补助时，自动合计该人员金额，显示于合计处，同时计算基本信息计划金额，并显示到计划金额处。
         * @param obj  修改金额的input对象
         * @return  pubAmtId
         */
        function countAmt(obj){

            //alert(obj.value+" ; "+obj.defaultValue); mType

            if(obj.value == obj.defaultValue)
                return;

            //修改金额
            var amt = (obj.value.trim().length<1) ? 0 : parseFloat(obj.value.trim());

            //原来金额
            var defaultAmt = (obj.defaultValue.trim().length<1) ? 0 : parseFloat(obj.defaultValue.trim());

            //校验输入金额是否大于标准
            var f = obj.getAttribute("flyvalue");

            if(f && f.trim().length>0){

                var s = parseFloat(f);

                if((amt-s)>0.01){
                    obj.value = defaultAmt;
                    alert("抱歉，输入金额大于标准金额，请重新输入。");
                    return;
                }
            }

            //总金额
            var totalObj = document.getElementById("planAmt");
            var total = (totalObj.value.trim().length<1) ? 0 : parseFloat(totalObj.value.trim());

            //人员合计金额
            var trObj = obj.parentNode.parentNode;
            var inputObj = trObj.cells[trObj.cells.length-1].getElementsByTagName("input")[0];
            var sum = (inputObj.value.trim().length<1) ? 0 : parseFloat(inputObj.value.trim());

            //计算合计和总计
            inputObj.value = Math.round((sum + amt - defaultAmt)*100)/100;
            totalObj.value = Math.round((total + amt - defaultAmt)*100)/100;

            //赋值指标使用金额
            flyEditPageSetIndexUse(amt - defaultAmt);

            return;
        }
        /**
         * 预算指标区域，选择指标回调函数
         * @param arr  选择返回指标信息数组
         * @param obj  选择表单对象
         * @return repeatCount
         */
        function indexSet(selArr,obj){

            var trObj = obj.parentNode.parentNode;
            var n = obj.parentNode.cellIndex;

            obj.value = selArr[4];
            obj.setAttribute("flyvalue",selArr[0]+"~"+selArr[1]);

            document.getElementById("indic_amt").value=  selArr[2];
            document.getElementById("indic_balance").value=  selArr[3];
            // trObj.cells[n+1].getElementsByTagName("input")[0].value = selArr[2];
            // trObj.cells[n+2].getElementsByTagName("input")[0].value = selArr[3];

            return;

        }

        // /**
        //  * 预算指标区域，用户输入本次使用金额，判断是否超出可用金额。如果超出，提示并恢复为原来金额。
        //  * @param obj  选择表单对象
        //  * @return
        //  */
        // function inputIndexAmtCheck(obj){
        //
        //     //取得可用指标金额
        //     var trObj = obj.parentNode.parentNode;
        //     var n = obj.parentNode.cellIndex;
        //     var e = parseFloat(trObj.cells[n-1].getElementsByTagName("input")[0].value);
        //
        //     var v = (obj.value.trim().length<1) ? 0 : parseFloat(obj.value);
        //
        //     if(v>e){
        //
        //         alert("使用金额大于可用金额，请重新输入。");
        //         obj.value = obj.defaultValue;
        //
        //         return;
        //     }
        // }

        /**
         * 上传附件，调用pubToolsUploadFileAsyn(obj,fileKey,showObj)方法
         * @param obj  选择表单对象
         * @ return
         */
        function uploadFile(obj){

            var fileKey = document.getElementById('billId').value;

            var showObj = document.getElementById('attchFiles');

            pubToolsUploadFileAsyn(obj,fileKey,showObj,"/fwis/mssl/payTraveApplySrv");

            return;
        }

        /**
         * 改变部门时，改变人员下拉列表为改变后部门的人员
         * @param obj  选择表单对象
         * @return
         */
        function changeDept(obj){

            var personobj=document.getElementById('personSelId');
            personobj.options.length=0;

            //生成部门所有人员下拉列表
            commonSelectAppSelectInit("personSel",obj.value,"","personSelId","");//人员下拉列表
        }

        /**
         * 新增、复制时进入页面：
         1、从后台取得自动生成的申请单号、登录人部门、姓名。
         2、生成人员下拉列表。
         3、设置默认申请部门、申请人员为登录人员

         * @return
         */
        function setInitInfo(dateKey){

            // alert(flyEditPageGetFlag())
            if(flyEditPageGetFlag()=="Add" || flyEditPageGetFlag()=="Copy") {

                var billInfo = toServerOp("AddBillInfo",dateKey);

                //billInfo格式：billId|deptId|personId
                var arr = billInfo.split("|");

                //设置申请单号
                document.getElementById("billId").value = arr[0];

                // //设置申请部门为登录人部门
                // var deptObj = document.getElementById("deptSelIdName");
                // deptObj.value = arr[1];

                //生成登录人部门所有人员下拉列表(根据登录人部门代码生成)。
                commonSelectAppSelectInit("personNewSel",loginInsId_a +"|"+ arr[1],"","personSelId",loginPerId_a,"");//人员下拉列表
                // //设置登录人为申请人
                // var perObj = document.getElementById("personSelIdName");
                // perObj.value = arr[2];

                //设置申请人为出差人
                // var deptName = deptObj.options[deptObj.selectedIndex].text;
                // var perName = perObj.options[perObj.selectedIndex].text;

                var deptName = document.getElementById("deptSelIdName").value;
                var perName = document.getElementById("personSelIdName").value;

                var perArr = [[arr[1],deptName,arr[2],perName]];
                var obj = document.getElementById('togetherId');

                commonSelectSetSelArrLabel(perArr,obj);

            }else if(flyEditPageGetFlag()=="Upd"){

                var billInfo = toServerOp("UpdBillInfo",dateKey);

                //billInfo格式：deptId|personId
                var arr = billInfo.split("|");

                //生成登录人部门所有人员下拉列表(根据登录人部门代码生成)。
                commonSelectAppSelectInit("personNewSel",loginInsId_a+"|"+arr[0],"","personSelId",arr[1],"");//人员下拉列表
                document.getElementById("finalMoneyData").innerText = document.getElementById("appBillAmtId").value; //planAmt appBillAmtId

                var payTableNone = document.getElementById("payTableId").querySelectorAll(".container");
                payTableNone[payTableNone.length-1].style.display = "none";
            }
            return;
        }

        function init(){

            // pageObj_a = flyEditPageGetGlobalPageObj();

            //取得登录单位
            loginInsId_a = getGlobleInsId();

            //取得登录部门
            loginDeptId_a = getGlobleDeptId();

            //取得登录人员
            loginPerId_a = getGloblePerId();

            //取得出差申请行程是否必输标志,Y必输
            var hotelWay = getGloblePayTravelApp();

            if(hotelWay == "Y"){

                // var obj = document.getElementById("planAmt");
                // obj.style.cssText = "background-color:#fafafa;text-align:right;";
                // obj.readOnly = true;
            }

            //根据设置，确定指标为申请人输入，还是特定岗位输入。
            flyEditPageSetIndexArea();

            flyEditPageSetApp("Y");//设置页面需要审批
            flyEditPageSetEditObjId("editForm"); //设置页面编辑显示区域id

            commonSelectAppSelectInit("deptSel",loginInsId_a,"","deptSelId",loginDeptId_a,"");//部门下拉列表
            commonSelectAppSelectInit("baseSelectSel","T0050|"+loginInsId_a,"","typeSel","","");//出差类别
            commonSelectAppSelectInit("baseSelectSel","T0051|"+loginInsId_a,"","dinnerSelId","","");//出差用餐情况
            commonSelectAppSelectInit("baseSelectSel","T0052|"+loginInsId_a,"","specialSel","","");//出差情况
            // commonSelectAppStaticSelectInit("travelStatus");
            commonSelectAppStaticSelectInit("travelTools_selOne");
            commonSelectAppStaticSelectInit("travelTools_selTwo");
            commonSelectAppStaticSelectInit("payTool_one");
            commonSelectAppStaticSelectInit("payTool_two");
            commonSelectAppStaticSelectInit("payTool_three");
            commonSelectAppStaticSelectInit("cardTools");


            //初始化页面参数
            flyEditPageGetParam();

            setInitInfo(flyEditPageGetUpdKey());//设置申请单号、申请人部门、名称

            // pubToolsImgSelEventAdd("cun","ab1");

            // var detailDiv = document.querySelectorAll("div[flyflag = '18']");
            // detailDiv.forEach(ele =>{
            //     var itemEle = ele.querySelectorAll(".item")[0];
            //     addSlideDelete(itemEle);
            // })

        }

    </script>

</head>

<body  onLoad="init()">
    <div class="box">
        <div id="editForm" class="apply">
            <div class="h-70">
                <a href="../mainpage.html"><span class="iconfont icon-jiantou ft-35"></span></a>
                <span class="ft-35">差旅费报销</span>
                <span></span>
            </div>
            <div class="apply-first">
                <div class="h-120">
                    <span><label flyflag='3' class="flyListPageStarLabel">*</label>报销单号</span>
                    <input id="billId" type="text" flyflag="0" readonly>
                    <span></span>
                </div>
                <div class="h-120">
                    <span><label flyflag='3' class="flyListPageStarLabel">*</label>报销名称</span>
                    <input id="billName" type="text" flyflag='0' necessary='1'  onblur='neceCheck(this)' maxlength='50' onkeyup='flyCheckStrInput(this);' readonly>
                    <span></span>
                </div>
                <div class="h-120  tanchuang" onclick="openSelectWindows(this)">
                    <span>报销部门</span>
                    <input type="text" flyflag='2' id="deptSelIdName" onchange="changeDept(this);" readonly>
                    <div class="ab">
                        <div class="nav"  id="deptSelId">

                        </div>
                    </div>
                    <span class="iconfont icon-z043"></span>
                </div>
                <div class="h-120  tanchuang" onclick="openSelectWindows(this)">
                    <span>报&nbsp;销&nbsp;人</span>
                    <input type="text" flyflag='2' id="personSelIdName" readonly>
                    <div class="ab">
                        <div class="nav" id="personSelId">

                        </div>
                    </div>
                    <span class="iconfont icon-z043"></span>
                </div>
                <div class="h-120">
                    <span>申&nbsp;请&nbsp;单</span>
                    <input id="appBillSelId" type="text" flyflag="2" necessary="1" onblur="neceCheck(this)" onclick="getSel(this,'A')" readonly>
                    <span class="iconfont icon-z043"></span>
                </div>
                <div class="h-120">
                    <span>申请金额</span>
                    <input id="appBillAmtId" type="text" flyflag='0' readonly>
                    <span></span>
                </div>
                <div class="h-120" style="display: none">
                    <span>报销总计</span>
                    <input id="planAmt" type="text" flyflag='0' value="0" readonly>
                    <span></span>
                </div>
                <div class="h-120" style="display: none">
                    <span>公务卡</span>
                    <input id="pubAmtId" type="text" flyflag='0' value="0" readonly>
                    <span></span>
                </div>
                <div class="h-120" style="display: none">
                    <span>个人转账</span>
                    <input id="cashAmtId" type="text" flyflag='0' value="0" readonly>
                    <span></span>
                </div>
                <div class="h-120" style="display: none">
                    <span>第三方转账</span>
                    <input id="thirdAmtId" type="text" flyflag='0' value="0" readonly>
                    <span></span>
                </div>

                <input id="borrowId" type="text" flyflag='2' readonly style="display:none">
                <input id="offAmt" type="text" flyflag='0' value="0" readonly style="display:none">

                <div class="h-120">
                    <span>事&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由</span>
                    <input id='reasonId' type="text"  flyflag='0' maxlength="100" onkeyup="flyCheckStrInput(this);">
                    <span></span>
                </div>
                <div class="h-120">
                    <span>项&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目</span>
                    <input id="itemId" type="text" flyflag='2' onclick="getSel(this,'I')" readonly>
                    <span class="iconfont icon-z043"></span>
                </div>


                <div class="h-120  tanchuang" onclick="openSelectWindows(this)">
                    <span>出差类别</span>
                    <input type="text" id="typeSelId" flyflag='2' onchange="flyEditPageSetAttch(this);" readonly>
                    <div class="ab">
                        <div class="nav" id="typeSel">

                        </div>
                    </div>
                    <span class="iconfont icon-z043"></span>
                </div>
                <div class="h-120  tanchuang" onclick="openSelectWindows(this)">
                    <span>出差情况</span>
                    <input type="text" id="specialSelId" flyflag='2' onchange="flyEditPageSetAttch(this);" readonly>
                    <div class="ab">
                        <div class="nav" id="specialSel" >

                        </div>
                    </div>
                    <span class="iconfont icon-z043"></span>
                </div>

                <div class="h-120">
                    <span>出差地点</span>
                    <input id="addrId" type="text"  flyflag='0' maxlength="100" onkeyup="flyCheckStrInput(this);">
                    <span></span>
                </div>
                <div class="h-120  tanchuang" onclick="openSelectWindows(this)">
                    <span>用餐情况</span>
                    <input id="dinnerSelIdName" type="text" flyflag='2'  readonly>
                    <div class="ab">
                        <div class="nav" id="dinnerSelId">

                        </div>
                    </div>
                    <span class="iconfont icon-z043"></span>
                </div>
                <div class="h-120">
                    <span>开始日期</span>
                    <input id="startDate" type="text" flyflag="0" class="wd-60"  onclick="pubToolsDateSel(this);" readonly>
                    <span  class="iconfont icon-z043 "></span>
                </div>
                <div class="h-120">
                    <span>结束日期</span>
                    <input id="endDate" type="text" flyflag="0" class="wd-60" onclick="pubToolsDateSel(this);" readonly>
                    <span class="iconfont icon-z043 "></span>
                </div>

                <div class="h-120">
                    <span>出差人员</span>
                    <span id="togetherId" necessary='2'  onblur='neceCheck(this)' flyflag='4' onclick="getSel(this,'P')" style='width:93%;min-height:30px;'></span>
                    <span></span>
                </div>

                <div class="h-120">
                    <span>出差人数</span>
                    <input id="togetherNumId" type="text" flyflag='0' onkeyup="flyCheckDigitInput(this,'I');" readonly>
                    <span></span>
                </div>
                <div class="h-120">
                    <span>差旅服务公司</span>
                    <input id="thirdPayInsId" type="text" flyflag='4' onclick="getSel(this,'T')" readonly>
                    <span class="iconfont icon-z043"></span>
                </div>
            </div>
            <div class="h-120">
                <span>备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注</span>
                <input type="text"  flyflag="0"  maxlength='100' onkeyup='flyCheckStrInput(this);'>
                <span></span>
            </div>

            <!--附件区域-->
            <div class="wd-100 bd-ef pd-20  apply-space">
                <div class="father">
                    <div class="add-img" flyflag="4">
                        <img src="../img/jiahao.png" class="cun"  id="cun">
                    </div>
                </div>
                <div class="ab1" id="ab1">
                    <div class="nav1"  id="nav1">
                        <div class="tu">
                            <span>选择图片</span>
                            <section class="z_file fl">
                                <input type="file" name="file" id="file" class="file" value=""
                                       accept="image/jpg,image/jpeg,image/png,image/bmp" multiple />
                            </section>
                        </div>
                        <div class="pai">
                            <span>拍照</span>
                            <input type="file" capture="camera" accept="image/*">
                        </div>
                        <div class="pai">
                            <span>扫码</span>
                            <input type="file" capture="camera" accept="image/*">
                        </div>
                        <div class="pai">
                            <span>连续扫码</span>
                            <input type="file" capture="camera" accept="image/*">
                        </div>
                        <p class="quxiao">取消</p>
                    </div>
                </div>
            </div>

            <!--指标区域-->
            <input type="text" flyflag='7'  flyvalue="々" style="display:none;">
            <div id="indexTable" class="apply-fourth apply-space" flyindex="N" flyflag='18'  flyset="6|0,2|3|0,1|1|2">

                <div class="container"  style="display:none" >
                    <div class="item" data-status="0">
                        <div class="content" flyshow='9' flyflag='9' flyvalue=""  onclick="windowShowDataInfo(this,0)">
                            <div class="apply-fourth-div"><div>
                                <span class="wd-50" flyshow='0'></span>
                                <span class="wd-20 jt-end cl-e0d">￥<span flyshow='0'>500</span></span>
                            </div>
                                <div>
                                    <span class="wd-10 ta-lt cl-0089D0" ><span  flyshow='0'>2020</span><span class="cl-afa-span">(年)</span></span>
                                    <span class="wd-60 cl-0089D0" ><span flyshow='0'>2000</span><span class="cl-afa-span">(总额)</span></span>
                                    <span class="wd-60 cl-0089D0"><span flyshow='0'>1000</span><span class="cl-afa-span">(余额)</span></span>
                                </div>
                            </div>
                        </div>
                        <div class="button-group">
                            <button class="del-btn" onclick="itemDelete(this)">删除</button>
                        </div>
                    </div>

                </div>
                <div class="cs-pt cl-e65 zhibiao" id="indicationInfo" >
                    <span onclick="openWindowData(this)">指标预算</span>
                    <div>
                        <div class="fixed fixed6" id="fixed-4" style="display: none">
                            <div class="lvcheng">
                                <div class="zhibiaoinfo">
                                    <span>支出指标</span>
                                    <input type="text" flyvalue="" class="wd-60" onclick="getSel(this,'D')" readonly>
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>
                                <div>
                                    <span>指标金额</span>
                                    <input id="indic_amt" type="text" class="wd-60" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>指标余额</span>
                                    <input id="indic_balance" type="text" class="wd-60" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>支出金额</span>
                                    <input type="text" class="wd-60" onfocus="this.defaultValue = this.value;" onkeyup="flyCheckDigitInput(this,'D');"  onblur="inputIndexAmtCheck(this)">
                                    <span></span>
                                </div>
                                <div>
                                    <span>对应支出项</span>
                                    <input type="text" class="wd-60" maxlength="50" onkeyup="flyCheckStrInput(this);">
                                    <span></span>
                                </div>
                                <div>
                                    <span>备注</span>
                                    <input type="text" class="wd-60" maxlength="50" onkeyup="flyCheckStrInput(this);">
                                    <span></span>
                                </div>
                                <div>
                                    <span  onclick="windowClose(this)">取消</span>
                                    <span onclick="infoConfirm(this,'','O')">确认继续</span>
                                    <span onclick="infoConfirm(this,'','C')">确认</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--行程区域-->
            <input type="text" flyflag='7'  flyvalue="々" style="display:none;">
            <div id="travelTableId" class="apply-second  apply-space"  flyflag='18'  flyset="10|3,1|5,1|4,1|6|1|2">
                <div class="container"  style="display:none;">
                    <div class="item" data-status="0" >
                        <div class="content" flyshow="9" flyflag="9" flyvalue=""  onclick="windowShowDataInfo(this,1)" on>
                            <div class="apply-second-hua">
                                <span flyshow='0'>北京</span>
                                <span class="xuxian"><span flyshow='0'>火车</span><i></i></span>
                                <span flyshow='0'>邯郸</span>
                                <span class="wd-20 ta-rt cl-e0d">￥<span  flyshow='0'>200</span></span>
                            </div>
                            <div class="apply-second-hua">
                                <span class="cl-afa"  flyshow='0'>2020-10-16</span>
                                <span></span>
                                <span class="cl-afa"  flyshow='0'>2020-10-16</span>
                                <span class="wd-10"></span>
                            </div>
                        </div>
                        <div class="button-group">
                            <button class="del-btn"  onclick="itemDelete(this)">删除</button>
                        </div>
                    </div>
                </div>

                <div class="cs-pt cl-e65 addlvcheng" id="travelInfo">
                    <span  onclick="openWindowData(this)">行程</span>
                    <div class="none">
                        <div class="fixed fixed2" id="fixed2">
                            <div class="lvcheng">
                                <div class="shijian1">
                                    <span>出发时间</span>
                                    <input type="text" id="date-group1-3" class="wd-60" onclick="pubToolsDateSel(this);"  readonly>
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>
                                <div class="shijian1">
                                    <span>到达时间</span>
                                    <input type="text" id="date-group1-4" class="wd-60" onclick="pubToolsDateSel(this);" readonly>
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>

                                <div>
                                    <span>出发地点</span>
                                    <input type="text" class="wd-50"  flyvalue=""  onclick="getSel(this,'R')"  readonly>
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>
                                <div class="jiaotong">
                                    <span>到达地点</span>
                                    <input type="text" class="wd-50"  flyvalue="" onclick="getSel(this,'R')"  readonly>
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>
                                <div class="tanchuang"  onclick="openSelectWindows(this)">
                                    <span>交通方式</span>
                                    <input type="text" class="wd-50" flyvalue="" onchange="flyEditPageSetAttch(this);" readonly>
                                    <div class="ab">
                                        <div class="nav" id="travelTools_selOne" >
                                            <div flyvalue="G2">高铁二等</div>
                                            <div flyvalue="G1">高铁一等</div>
                                            <div flyvalue="P1">飞机经济舱</div>
                                            <div flyvalue="P2">飞机头等舱</div>

                                            <div flyvalue="T1">火车硬座</div>
                                            <div flyvalue="T2">火车硬卧</div>
                                            <div flyvalue="T3">火车软卧</div>

                                            <div flyvalue="B">大巴</div>
                                            <div flyvalue="D">单位派车</div>
                                            <div flyvalue="E">租车</div>
                                            <div flyvalue="X">出租车</div>
                                            <div flyvalue="S">自驾</div>
                                            <div flyvalue="G">高铁商务</div>
                                            <div flyvalue="T4">火车软席</div>
                                            <div flyvalue="P3">飞机商务舱</div>
                                            <div flyvalue="O">其他</div>
                                        </div>
                                    </div>
                                    <span class="iconfont icon-z043" style="margin-right: 20px"></span>
                                </div>
                                <div>
                                    <span>交通费</span>
                                    <input type="text" class="wd-60" onfocus="this.defaultValue = this.value;" onkeyup="flyCheckDigitInput(this,'D');" >
                                    <span></span>
                                </div>
                                <div class="tanchuang"  onclick="openSelectWindows(this)">
                                    <span>支付类别</span>
                                    <input type="text" class="wd-50" flyvalue=""  onchange="flyEditPageSetAttch(this);" readonly>
                                    <div class="ab">
                                        <div class="nav" id="payTool_one" >
                                            <div flyvalue="C">个人账户</div>
                                            <div flyvalue="P">公务卡</div>
                                            <div flyvalue="T">第三方转账</div>
                                        </div>
                                    </div>
                                    <span class="iconfont icon-z043" style="margin-right: 20px"></span>
                                </div>
                                <div>
                                    <span>备注(车牌号)</span>
                                    <input type="text" class="wd-60" maxlength="100"  onkeyup="flyCheckStrInput(this);">
                                    <span></span>
                                </div>
                                <div>
                                    <span>电子票据</span>
                                    <input type="text" class="wd-60" maxlength="100"  onkeyup="flyCheckStrInput(this);">
                                    <span></span>
                                </div>
                                <div>
                                    <span  onclick="windowClose(this)">取消</span>
                                    <span onclick="travelConfirmFun(this,'addNumInfo','O')">确认继续</span>
                                    <span onclick="travelConfirmFun(this,'addNumInfo','C')">确认</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 城市间交通 -->
            <input type="text" flyflag='7'  flyvalue="々" style="display:none;">
            <div id="cityId" class="apply-second  apply-space"  flyflag='18'  flyset="11|1,3|2,1|8|5,1|7,1|6,1|4"  flydel="N">

                <div class="container" style="display: none">
                    <div class="item" data-status="0">
                        <div class="content" flyshow="9" flyflag='9' flyvalue='' onclick="windowShowDataInfo(this,1)">
                            <div class="apply-second-hua">
                                <span class="wd-50"><span flyshow="0">曹雨虹</span>(<span flyshow="0">科级</span>)</span>
                                <span class="wd-15 ta-rt cl-e0d">￥<span flyshow="0">23465</span></span>
                            </div>
                            <div class="apply-second-hua">
                                <span class="cl-afa" flyshow="0">
                                    邯郸
                                </span>
                                <span class="ta-ct xuxian cl-afa xuxian-cl-afa">
                                    <span flyshow="0">火车</span>
                                    <i class="cl-afa"></i>
                                </span>
                                <span class="ta-ct cl-afa" flyshow="0">北京</span>
                                <span class="wd-25 cl-afa" flyshow="0">2020-09-18</span>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="cl-e65 cs-pt chengjian" id="city" >
                    <span>城间交通</span>
                    <div class="none">
                        <div class="fixed fixed3" id="fixed3">
                            <div class="lvcheng">
                                <div>
                                    <span>姓名</span>
                                    <input type="text" class="wd-60"  flyvalue="" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>级别</span>
                                    <input type="text" class="wd-60"  flyvalue="" readonly>
                                    <span></span>
                                </div>
                                <div class="shijian1">
                                    <span>出发时间</span>
                                    <input id="date-group1-5" class="wd-60" type="text"  readonly>
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>
                                <div class="shijian1">
                                    <span>到达时间</span>
                                    <input readonly class="wd-60" type="text" id="date-group1-6" >
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>
                                <div>
                                    <span>出发地点</span>
                                    <input type="text" class="wd-50" flyvalue=""  onclick="getSel(this,'R')" readonly>
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>
                                <div class="jiaotong">
                                    <span>到达地点</span>
                                    <input type="text" class="wd-50" flyvalue=""  onclick="getSel(this,'R')" readonly>
                                    <span class="iconfont icon-z043 wd-10"></span>
                                </div>
                                <div class="tanchuang"  onclick="openSelectWindows(this)">
                                    <span>交通方式</span>
                                    <input type="text" class="wd-50"  flyvalue="" onchange="flyEditPageSetAttch(this);" readonly>
                                    <div class="ab">
                                        <div class="nav" id="travelTools_selTwo" >
                                            <div flyvalue="G2">高铁二等</div>
                                            <div flyvalue="G1">高铁一等</div>
                                            <div flyvalue="P1">飞机经济舱</div>
                                            <div flyvalue="P2">飞机头等舱</div>

                                            <div flyvalue="T1">火车硬座</div>
                                            <div flyvalue="T2">火车硬卧</div>
                                            <div flyvalue="T3">火车软卧</div>

                                            <div flyvalue="B">大巴</div>
                                            <div flyvalue="D">单位派车</div>
                                            <div flyvalue="E">租车</div>
                                            <div flyvalue="X">出租车</div>
                                            <div flyvalue="S">自驾</div>
                                            <div flyvalue="G">高铁商务</div>
                                            <div flyvalue="T4">火车软席</div>
                                            <div flyvalue="P3">飞机商务舱</div>
                                            <div flyvalue="O">其他</div>
                                        </div>
                                    </div>
                                    <span class="iconfont icon-z043" style="margin-right: 20px"></span>
                                </div>
                                <div>
                                    <span>交通费</span>
                                    <input type="text" class="wd-60" onfocus="this.defaultValue = this.value;" onkeyup="flyCheckDigitInput(this,'D');" >
                                    <span></span>
                                </div>
                                <div class="tanchuang" onclick="openSelectWindows(this)">
                                    <span>支付类别</span>
                                    <input type="text" class="wd-50"  flyvalue="" onchange="flyEditPageSetAttch(this);" readonly>
                                    <div class="ab">
                                        <div class="nav" id="payTool_two" >
                                            <div flyvalue="C">个人账户</div>
                                            <div flyvalue="P">公务卡</div>
                                            <div flyvalue="T">第三方转账</div>
                                        </div>
                                    </div>
                                    <span class="iconfont icon-z043" style="margin-right: 20px"></span>
                                </div>
                                <div>
                                    <span>备注(车牌号)</span>
                                    <input type="text" class="wd-60" >
                                    <span></span>
                                </div>
                                <div>
                                    <span  onclick="windowClose(this)">取消</span>
                                    <span onclick="infoConfirm(this,'addNumInfo','O')">确认继续</span>
                                    <span onclick="infoConfirm(this,'addNumInfo','C')">确认</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 住宿与补助 -->
            <input type="text" flyflag='7'  flyvalue="々" style="display:none;">
            <div id="stayId" class="apply-second  apply-space"  flyflag='18'  flyset="14|1,3|2,1|3,1|4|7|9|11"  flydel="N">

                <div class="container" style="display:none;">
                    <div class="item" data-status='0'>
                        <div class="content" flyshow="9" flyflag="9" flyvalue="" onclick="windowShowDataInfo(this,1)">
                            <div class="apply-second-hua">
                                <span><span flyshow="0">曹雨虹</span>(<span flyshow="0">科级</span>)</span>
                                <span><span flyshow="0"></span>(<span flyshow="0">3</span>天)</span>
                            </div>
                            <div class="apply-second-hua">
                                <span class="cl-0089D0"><span flyshow="0">200</span><span class="cl-afa-span">(住宿)</span></span>
                                <span class="cl-0089D0"><span flyshow="0">100</span><span class="cl-afa-span">(伙食补助)</span></span>
                                <span class="cl-0089D0"><span flyshow="0">30</span><span class="cl-afa-span">(交通补助)</span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="cs-pt cl-e65 zhusubuzhu" id="zhusubuzhu">
                    <span>住宿和补助</span>
                    <div class="none">
                        <div class="fixed fixed4" id="fixed4">
                            <div class="lvcheng">
                                <div>
                                    <span>姓名</span>
                                    <input type="text" class="wd-60" flyvalue="" >
                                    <span></span>
                                </div>
                                <div>
                                    <span>级别</span>
                                    <input type="text" class="wd-60" flyvalue="" >
                                    <span></span>
                                </div>
                                <div>
                                    <span>地点</span>
                                    <input type="text" class="wd-60" flyvalue="">
                                    <span></span>
                                </div>
                                <div>
                                    <span>天数</span>
                                    <input type="text" class="none">
                                    <input type="text" class="wd-60" >
                                    <span></span>
                                </div>
                                <div>
                                    <span>住宿标准</span>
                                    <input type="text" class="wd-60" value="100" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>住宿金额</span>
                                    <input type="text" class="wd-60" value="100">
                                    <span></span>
                                </div>
                                <div>
                                    <span>伙食补助标准</span>
                                    <input type="text" class="wd-60" value="50" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>伙食金额</span>
                                    <input type="text" class="wd-60" value="100">
                                    <span></span>
                                </div>
                                <div>
                                    <span>交通补助标准</span>
                                    <input type="text" class="wd-60" value="60"  readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>交通补助金额</span>
                                    <input type="text" class="wd-60" value="100">
                                    <span></span>
                                </div>
                                <div class="tanchuang"  onclick="openSelectWindows(this)">
                                    <span>住宿支付类别</span>
                                    <input type="text" class="wd-50" flyvalue="" onchange="flyEditPageSetAttch(this);" readonly>
                                    <div class="ab">
                                        <div class="nav" id="payTool_three" >
                                            <div flyvalue="C">个人账户</div>
                                            <div flyvalue="P">公务卡</div>
                                            <div flyvalue="T">第三方转账</div>
                                        </div>
                                    </div>
                                    <span class="iconfont icon-z043" style="margin-right: 20px"></span>
                                </div>
                                <div>
                                    <span>电子票据</span>
                                    <input type="text" class="wd-60" value="">
                                    <span></span>
                                </div>
                                <div>
                                    <span  onclick="windowClose(this)">取消</span>
                                    <span  onclick="infoConfirm(this,'addNumInfoS','O')">确认继续</span>
                                    <span  onclick="infoConfirm(this,'addNumInfoS','C')">确认</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 费用计算 -->
            <input type="text" flyflag='7'  flyvalue="々" style="display:none;">
            <div id="subsidyId" class="apply-third apply-space"  flyflag='18'  flyset="14|1,3|2,1|3|5|6|7"  flydel="N">

                <div class="container"  style="display: none">
                    <div class="item" data-status='0'>
                        <div class="content"  flyshow="9" flyflag="9" flyvalue="" onclick="windowShowDataInfo(this,1)">
                            <div class="apply-third-div">
                                <span class="wd-60"><span flyshow="0">曹雨虹</span>(<span flyshow="0">科级</span>)</span>
                                <span class="jt-end" e0d><span flyshow="0">2</span>(天)</span>
                            </div>
                            <div class="apply-third-div">
                                <span class="wd-60 cl-0089D0 ta-lt"><span flyshow="0">4000000</span><span class="cl-afa-span">(交通费)</span></span>
                                <span class="wd-60 cl-0089D0"><span flyshow="0">4000000</span><span class="cl-afa-span">(住宿费)</span></span>
                                <span class="wd-60 cl-0089D0 ta-rt"><span flyshow="0">4000000</span><span class="cl-afa-span">(伙食)</span></span>
                            </div>
                        </div>
                        <div class="button-group">
                            <button class="del-btn" onclick="itemDelete(this)">删除</button>
                        </div>
                    </div>
                </div>

                <div class="cl-e65 cs-pt jisuan apply-third-last" id="jisuan">
                    <span>费用计算</span>
                    <div class="none">
                        <div class="fixed fixed1" id="fixed1">
                            <div class="lvcheng jiaotong">
                                <div>
                                    <span>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名</span>
                                    <input type="text" class="wd-60"   flyvalue="" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>级&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别</span>
                                    <input type="text" class="wd-60" flyvalue=""  readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>天数</span>
                                    <input type="text" class="none">
                                    <input type="text" class="wd-60" >
                                    <span></span>
                                </div>
                                <div>
                                    <span>交通费</span>
                                    <input type="text" class="wd-60" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>住&nbsp;宿&nbsp;费</span>
                                    <input type="text" class="wd-60" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>伙食补助</span>
                                    <input type="text" class="wd-60" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>交通补助</span>
                                    <input type="text" class="wd-60" readonly>
                                    <span></span>
                                </div>
                                <div>
                                    <span>其他费用</span>
                                    <input type="text" class="wd-60"  onkeyup="flyCheckDigitInput(this,'D');" >
                                    <span></span>
                                </div>
                                <div class="tanchuang"  onclick="openSelectWindows(this)">
                                    <span>住宿支付类别</span>
                                    <input type="text" class="wd-50" flyvalue="" onchange="flyEditPageSetAttch(this);" readonly>
                                    <div class="ab">
                                        <div class="nav" id="payTool_four" >
                                            <div flyvalue="C">个人账户</div>
                                            <div flyvalue="P">公务卡</div>
                                            <div flyvalue="T">第三方转账</div>
                                        </div>
                                    </div>
                                    <span class="iconfont icon-z043" style="margin-right: 20px"></span>
                                </div>
                                <div>
                                    <span>公务卡</span>
                                    <input type="text" class="wd-60"  onkeyup="flyCheckDigitInput(this,'D');" >
                                    <span></span>
                                </div>
                                <div>
                                    <span>个人账户</span>
                                    <input type="text" class="wd-60"  onkeyup="flyCheckDigitInput(this,'D');" >
                                    <span></span>
                                </div>
                                <div>
                                    <span>第三方转账</span>
                                    <input type="text" class="wd-60"  onkeyup="flyCheckDigitInput(this,'D');" >
                                    <span></span>
                                </div>
                                <div>
                                    <span onclick="windowClose(this)">取消</span>
                                    <span  onclick="infoConfirm(this,'addNumInfoS','O')">确认继续</span>
                                    <span  onclick="infoConfirm(this,'addNumInfoS','C')">确认</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--支付信息-->
            <input type="text" flyflag='7'  flyvalue="々" style="display:none;">
            <div id="payTableId" class="apply-fifth apply-space applyLastDiv" flyflag='18'  flyset="5|0,2|4,1|3|1,1|2"  flydel="N">

                <div class="container" style="display: none">
                    <div class="item" data-status='0' >
                        <div class="content" flyshow="9" flyflag="9" flyvalue="" onclick="windowShowDataInfo(this,0)">
                            <div class="apply-fifth-div">
                                <div>
                                    <span class="wd-50"><span flyshow="0">收款人1</span>(<span flyshow="0">公务卡</span>)</span>
                                    <span class="wd-50 cl-e0d jt-end">￥<span flyshow="0">1000</span></span>
                                </div>
                                <div>
                                    <span class="wd-30 cl-afa ta-lt"><span flyshow="0">亚运村支行</span></span>
                                    <span class="wd-70 cl-afa jt-end"><span flyshow="0">222222222222222222222</span></span>
                                </div>

                            </div>
                        </div>
                        <div class="button-group">
                            <button class="del-btn" onclick="itemDelete(this)">删除</button>
                        </div>
                    </div>
                </div>


                <div class="cs-pt cl-e65 zhifuxinxi" id="zhifuxinxi">
                    <span onclick="openWindowData(this)">支付信息</span>
                    <div class="none">
                        <div class="fixed fixed5" id="fixed-3">
                            <div class="lvcheng">
                                <div>
                                    <span>收款人</span>
                                    <input type="text" flyvalue="" class="wd-60" >
                                    <span></span>
                                </div>
                                <div>
                                    <span>开户行</span>
                                    <input type="text" flyvalue='' class="wd-60" >
                                    <span></span>
                                </div>
                                <div>
                                    <span>账号</span>
                                    <input type="text" class="wd-60" onfocus="this.defaultValue = this.value;" onkeyup="flyCheckDigitInput(this,'I');">
                                    <span></span>
                                </div>
                                <div>
                                    <span>金额</span>
                                    <input type="text" class="wd-60"   onfocus="this.defaultValue = this.value;" onkeyup="flyCheckDigitInput(this,'D');">
                                    <span></span>
                                </div>
                                <div class="tanchuang"  onclick="openSelectWindows(this)">
                                    <span>支付类别</span>
                                    <input type="text" class="wd-50"  flyvalue="" onchange="flyEditPageSetAttch(this);" readonly>
                                    <div class="ab">
                                        <div class="nav" id="cardTools" >
                                            <div flyvalue="C">储蓄卡</div>
                                            <div flyvalue="P">公务卡</div>
                                            <div flyvalue="T">第三方转账</div>
                                        </div>
                                    </div>
                                    <span class="iconfont icon-z043" style="margin-right: 20px"></span>
                                </div>
                                <div>
                                    <span  onclick="windowClose(this)">取消</span>
                                    <span  onclick="infoConfirm(this,'addNumInfo','O')">确认继续</span>
                                    <span  onclick="infoConfirm(this,'addNumInfo','C')">确认</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="apply-footer">
                <div class="moneyFinal">
                    <span class="cl-afa">合计：</span>
                    <span class="cl-e0d" id="finalMoneyData">0</span>
                </div>
                <div  id="footerSaveButton" class="footerSave">
                    <a href="#" onClick="flyEditPageAddSave();">保存</a>
                </div>
                <div class="footerSA">
                    <a href="#" onClick="flyEditPageSaveApprove();">保存审批</a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
<!--<script src="../js/zui.js"></script>-->
<!--<script src="../js/imgUp.js"></script>-->



